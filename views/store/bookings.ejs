<%- include('../partials/head') %>

<% 
  // Date Logic for Checkout
  let checkoutdate = null;
  if (booking?.date && booking?.days) {
      const tempDate = new Date(booking.date);
      tempDate.setDate(tempDate.getDate() + Number(booking.days));
      checkoutdate = tempDate.toISOString().split("T")[0];
  }

  // Calculation Logic
  const stayDays = Number(booking?.days) || 1;
  const nightlyRate = Number(home.price);
  const cleaningFee = 85;
  const serviceFee = Math.round(nightlyRate * stayDays * 0.14);
  const totalBase = (nightlyRate * stayDays) + cleaningFee + serviceFee;
%>

<body class="bg-white antialiased text-slate-900">
    <%- include('../partials/nav') %>

    <main class="mx-auto max-w-7xl px-4 pt-24 pb-16 sm:px-6 lg:px-8">
        <header class="mb-6">
            <div class="flex flex-col md:flex-row md:items-end justify-between gap-4">
                <div>
                    <h1 class="text-3xl font-medium tracking-tight text-slate-900"><%= home.homeName %></h1>
                    <div class="mt-2 flex items-center gap-3 text-sm font-medium">
                        <span class="flex items-center gap-1">
                            <svg class="w-4 h-4 text-rose-500" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                            <%= home.rating %>
                        </span>
                        <span class="text-slate-400">¬∑</span>
                        <span class="underline cursor-pointer"><%= home.location %></span>
                    </div>
                </div>
                <div class="flex gap-4">
                    <button class="flex items-center gap-2 text-sm font-medium underline hover:bg-gray-100 px-3 py-2 rounded-lg transition">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/></svg> Share
                    </button>
                    <button class="flex items-center gap-2 text-sm font-medium underline hover:bg-gray-100 px-3 py-2 rounded-lg transition">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg> Save
                    </button>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-4 grid-rows-2 gap-2 h-[300px] md:h-[450px] lg:h-[560px] overflow-hidden rounded-2xl mb-12 relative group">
            <div class="col-span-2 row-span-2 overflow-hidden">
                <img src="<%= home.photoUrl %>" class="h-full w-full object-cover hover:brightness-90 transition duration-500 cursor-pointer" alt="Main Photo">
            </div>
            <div class="overflow-hidden hidden sm:block">
                <img src="https://images.unsplash.com/photo-1512917774080-9991f1c4c750?auto=format&fit=crop&q=80&w=1000" class="h-full w-full object-cover hover:brightness-90 transition duration-500 cursor-pointer">
            </div>
            <div class="overflow-hidden hidden sm:block">
                <img src="https://images.unsplash.com/photo-1613490493576-7fde63acd811?auto=format&fit=crop&q=80&w=1000" class="h-full w-full object-cover hover:brightness-90 transition duration-500 cursor-pointer">
            </div>
            <div class="overflow-hidden hidden sm:block">
                <img src="https://images.unsplash.com/photo-1613977257363-707ba9348227?auto=format&fit=crop&q=80&w=1000" class="h-full w-full object-cover hover:brightness-90 transition duration-500 cursor-pointer">
            </div>
            <div class="overflow-hidden hidden sm:block">
                <img src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c?auto=format&fit=crop&q=80&w=1000" class="h-full w-full object-cover hover:brightness-90 transition duration-500 cursor-pointer">
            </div>
            <button class="absolute bottom-6 right-6 bg-white border border-slate-900 px-4 py-1.5 rounded-lg text-sm font-semibold shadow-md flex items-center gap-2 hover:bg-slate-50">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"/></svg> Show all photos
            </button>
        </div>

        <div class="grid lg:grid-cols-3 gap-16">
            <div class="lg:col-span-2">
                <div class="flex justify-between items-start border-b pb-8 mb-8">
                    <div>
                        <h2 class="text-2xl font-semibold">Hosted by Premier Collections</h2>
                        <ol class="flex items-center text-slate-600 space-x-2 mt-1">
                            <li><%= home.guests %> guests</li>
                            <li class="before:content-['¬∑'] before:mr-2"><%= home.bedrooms %> bedrooms</li>
                            <li class="before:content-['¬∑'] before:mr-2"><%= home.bathrooms %> baths</li>
                        </ol>
                    </div>
                    <div class="h-12 w-12 rounded-full bg-slate-100 overflow-hidden shadow-inner">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=<%= home.id %>" alt="Host">
                    </div>
                </div>

                <div class="space-y-6 border-b pb-8 mb-8">
                    <div class="flex gap-4">
                        <span class="text-2xl mt-1">üèÜ</span>
                        <div>
                            <p class="font-semibold">Top 1% of homes</p>
                            <p class="text-slate-500 text-sm">This home is highly ranked based on ratings, reviews, and reliability.</p>
                        </div>
                    </div>
                    <div class="flex gap-4">
                        <span class="text-2xl mt-1">üîë</span>
                        <div>
                            <p class="font-semibold">Seamless check-in</p>
                            <p class="text-slate-500 text-sm">Highly rated for its check-in experience.</p>
                        </div>
                    </div>
                </div>

                <div class="prose prose-slate max-w-none">
                    <h2 class="text-xl font-semibold mb-4">About this place</h2>
                    <p class="text-slate-600 leading-relaxed">
                        A stunning modern escape in <%= home.location %>. This professionally managed property 
                        (Home ID: <%= home.id %>) combines luxury design with the comfort of home. 
                        Whether you're here for work or relaxation, enjoy the high-speed wifi and private amenities.
                    </p>
                </div>
            </div>

            <div class="lg:col-span-1 relative">
                <div class="sticky top-28 rounded-3xl border border-slate-200 p-6 shadow-2xl bg-white">
                    <div class="flex justify-between items-baseline mb-6">
                        <div class="flex items-baseline gap-1">
                            <span class="text-2xl font-bold">$<%= home.price %></span>
                            <span class="text-slate-500 font-normal">night</span>
                        </div>
                        <div class="text-sm font-semibold">
                            ‚òÖ <%= home.rating %>
                        </div>
                    </div>

                    <div class="border border-slate-400 rounded-xl mb-4">
                        <div class="grid grid-cols-2 border-b border-slate-400">
                            <div class="p-3 border-r border-slate-400">
                                <label class="block text-[10px] font-extrabold uppercase tracking-wider">Check-in</label>
                                <div class="text-sm text-slate-700 font-medium"><%= booking?.date || 'Add date' %></div>
                            </div>
                            <div class="p-3">
                                <label class="block text-[10px] font-extrabold uppercase tracking-wider">Checkout</label>
                                <div class="text-sm text-slate-700 font-medium font-bold text-rose-600">
                                    <%= checkoutdate || "Add date" %>
                                </div>
                            </div>
                        </div>
                        <div class="p-3">
                            <label class="block text-[10px] font-extrabold uppercase tracking-wider">Guests</label>
                            <div class="text-sm text-slate-700 font-medium"><%= booking?.persons || '1' %> guest</div>
                        </div>
                    </div>

                    <button class="w-full py-3.5 bg-gradient-to-r from-rose-600 via-rose-500 to-pink-600 text-white font-bold rounded-lg text-lg shadow-lg hover:shadow-rose-200 transition-all active:scale-95 mb-4">
                        Reserve Now
                    </button>

                    <p class="text-center text-slate-500 text-xs mb-6">You won't be charged yet</p>

                    <div class="space-y-3 text-slate-600">
                        <div class="flex justify-between underline underline-offset-4 decoration-slate-300">
                            <span>$<%= home.price %> x <%= stayDays %> nights</span>
                            <span>$<%= (nightlyRate * stayDays).toLocaleString() %></span>
                        </div>
                        <div class="flex justify-between underline underline-offset-4 decoration-slate-300">
                            <span>Cleaning fee</span>
                            <span>$<%= cleaningFee %></span>
                        </div>
                        <div class="flex justify-between underline underline-offset-4 decoration-slate-300">
                            <span>Airbnb service fee</span>
                            <span>$<%= serviceFee.toLocaleString() %></span>
                        </div>
                        
                        <div class="h-px bg-slate-200 my-4"></div>
                        
                        <div class="flex justify-between text-slate-900 font-bold text-lg">
                            <span>Total before taxes</span>
                            <span>$<%= totalBase.toLocaleString() %></span>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 flex items-center gap-4 p-4 border border-slate-200 rounded-xl bg-slate-50/50">
                    <svg class="w-8 h-8 text-rose-500" fill="currentColor" viewBox="0 0 20 20"><path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"/></svg>
                    <p class="text-[11px] font-medium leading-tight">This is a popular find. People are searching for stays in <%= home.location %> right now.</p>
                </div>
            </div>
        </div>
    </main>
</body>